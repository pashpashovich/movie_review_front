<div class="container my-5" *ngIf="movie as m">
  <h1 class="text-center mb-4 text-primary fw-bold">üé¨ {{ m.title }}</h1>
  <div class="row">
    <div class="col-md-4 text-center">
      <img
        *ngIf="m.poster; else defaultPoster"
        [src]="m.poster"
        class="img-fluid rounded shadow-lg"
        alt="{{ m.title }}"
      />
      <ng-template #defaultPoster>
        <img
          [src]="defaultPoster"
          class="img-fluid rounded shadow-lg"
          alt="{{ m.title }}"
        />
      </ng-template>
    </div>
    <div class="col-md-8">
      <ul class="list-group mb-4 shadow-sm rounded">
        <li class="list-group-item">
          <strong>‚≠ê –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥:</strong>
          <span class="text-warning rating">
            <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
              <i
                class="bi"
                [ngClass]="{
                  'bi-star-fill': star <= (averageRating ?? 0),
                  'bi-star': star > (averageRating ?? 0)
                }"
                style="color: gold"
              ></i>
            </ng-container>
            ({{
              averageRating !== null
                ? averageRating.toFixed(1)
                : "–ù–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞"
            }})
          </span>
        </li>
        <li class="list-group-item">
          <strong>üìú –û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ m.description }}
        </li>
        <li class="list-group-item">
          <strong>üé≠ –ñ–∞–Ω—Ä—ã:</strong>
          <span class="badge bg-primary me-1" *ngFor="let g of m.genres">{{
            g
          }}</span>
        </li>
        <li class="list-group-item">
          <strong>üé¨ –†–µ–∂–∏—Å—Å—ë—Ä—ã:</strong>
          <span
            class="badge bg-warning text-dark me-1"
            *ngFor="let d of m.directors"
            >{{ d }}</span
          >
        </li>
        <li class="list-group-item">
          <strong>üé≠ –ê–∫—Ç—ë—Ä—ã:</strong>
          <span
            class="badge bg-info text-dark me-1"
            *ngFor="let k of m.actors"
            >{{ k }}</span
          >
        </li>
        <li class="list-group-item">
          <strong>üé¨ –ü—Ä–æ–¥—é—Å–µ—Ä—ã:</strong>
          <span
            class="badge bg-secondary text-white me-1"
            *ngFor="let k of m.producers"
            >{{ k }}</span
          >
        </li>
      </ul>

      <form
        (submit)="submitRating(); $event.preventDefault()"
        class="shadow-sm p-3 rounded"
      >
        <strong>üì¢ –í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞:</strong>
        <div class="rating">
          <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
            <input
              type="radio"
              [id]="'star-' + star + '-' + m.id"
              name="userRating"
              [value]="star"
              (change)="selectRating(star)"
              [checked]="star === selectedRating"
              hidden
            />
            <label [for]="'star-' + star + '-' + m.id" class="star-label">
              <i
                class="bi"
                [ngClass]="{
                  'bi-star-fill': star <= selectedRating,
                  'bi-star': star > selectedRating
                }"
                style="font-size: 1.8rem; cursor: pointer; color: gold"
              ></i>
            </label>
          </ng-container>
        </div>
        <button type="submit" class="btn btn-success w-100 mt-3">
          {{ ratingId ? "üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥" : "‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥" }}
        </button>
      </form>

      <button
        class="btn btn-outline-success w-100 mt-3"
        [disabled]="inList"
        (click)="addToWatchlist()"
      >
        <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –≤ Watchlist
      </button>
      <span *ngIf="inList" class="text-muted ms-2">‚úÖ –£–∂–µ –≤ —Å–ø–∏—Å–∫–µ</span>
    </div>
  </div>

  <div class="card mt-4 shadow-lg">
    <div class="card-body">
      <h3 class="text-center">üí¨ –û—Ç–∑—ã–≤—ã</h3>
      <ng-container *ngIf="reviews.length > 0; else noReviews">
        <ul class="list-group">
          <li class="list-group-item" *ngFor="let r of reviews">
            <strong>üë§ {{ r.username }}</strong> (‚≠ê {{ r.rating }}/5)
            <small class="text-muted ms-2">{{ r.createdAt }}</small>
            <p class="mb-0">üìù {{ r.content }}</p>
          </li>
        </ul>
      </ng-container>
      <ng-template #noReviews>
        <p class="text-center text-muted">üöÄ –ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤</p>
      </ng-template>
    </div>
  </div>

  <div class="card mt-4 shadow-lg">
    <div class="card-body">
      <h3 class="text-center">‚úèÔ∏è –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h3>
      <form [formGroup]="reviewForm" (ngSubmit)="submitReview()">
        <div class="mb-3">
          <label for="reviewContent" class="form-label">üìù –¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞</label>
          <textarea
            id="reviewContent"
            rows="5"
            class="form-control shadow-sm"
            formControlName="content"
            required
          ></textarea>
          <div
            *ngIf="
              reviewForm.get('content')?.invalid &&
              (reviewForm.get('content')?.dirty ||
                reviewForm.get('content')?.touched)
            "
            class="text-danger"
          >
            –ú–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤
          </div>
        </div>
        <div class="mb-3">
          <label for="reviewRating" class="form-label">‚≠ê –û—Ü–µ–Ω–∫–∞</label>
          <select
            id="reviewRating"
            class="form-select shadow-sm"
            formControlName="rating"
            required
          >
            <option *ngFor="let star of [1, 2, 3, 4, 5]" [value]="star">
              {{ star }}
            </option>
          </select>
        </div>
        <button
          type="submit"
          class="btn btn-success w-100"
          [disabled]="reviewForm.invalid"
        >
          üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å
        </button>
      </form>
    </div>
  </div>
</div>
